name: 自动化构建部署
on:
  # 哪些钩子触发，这里是 push
  push:
    branches:
      # 具体的分支
      - master
jobs:
  build:
    # 运行环境，这里是 ubuntu
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        # 检出对应代码
        uses: actions/checkout@v3
      - name: Install Node.js
        # 设置node环境
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
      - name: 打包
        run: |
          npm install
          npm run build
      - name: 上传静态资源到服务器
        uses: easingthemes/ssh-deploy@main
        with:
          # ssh公钥
          SSH_PRIVATE_KEY: ${{ secrets.DEPLOY }}
          # 复制操作的参数。"-avzr --delete"意味部署时清空服务器目标目录下的文件
          ARGS: "-avz --delete"
          # 打包出来的静态代码
          SOURCE: "dist/"
          # 部署目标主机 xx.xx.xx.xx
          REMOTE_HOST: ${{ secrets.HOST }}
          # 登录用户 root 或其他的 user
          REMOTE_USER: ${{ secrets.USER }}
          # 部署目标目录
          TARGET: /var/www/html/dist
      - name: 通知
        run: | 
          curl --location 'https://sctapi.ftqq.com/${{secrets.FT_KEY}}.send' --header 'Content-Type: application/x-www-form-urlencoded' --data-urlencode 'text=部署成功了～～～'

